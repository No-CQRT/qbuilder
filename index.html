<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Query Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"> <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            max-width: 800px;
        }
        .form-control, .form-select, .form-range {
            background-color: #333;
            color: #e0e0e0;
            border-color: #555;
        }
        .form-control::placeholder {
            color: #aaa;
        }
        .form-control:focus, .form-select:focus, .form-range:focus {
            background-color: #444;
            color: #fff;
            border-color: #666;
            box-shadow: 0 0 0 0.25rem rgba(108, 117, 125, 0.25);
        }
        .btn-primary {
            background-color: #4a90e2;
            border-color: #4a90e2;
        }
        .btn-primary:hover {
            background-color: #357bd2;
            border-color: #357bd2;
        }
        .card {
            background-color: #1e1e1e;
            border-color: #333;
        }
        .card-header {
            background-color: #2c2c2c;
            border-color: #333;
        }
        .form-label, .form-check-label, #timeRangeValue {
            color: #b0b0b0; /* Un grigio leggero per il testo */
        }
        h1 {
            color: #b0b0b0; /* Anche il titolo in grigio */
        }
        .input-group .form-control {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-group .btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .site-badge {
            display: inline-flex;
            align-items: center;
            background-color: #4a90e2;
            color: white;
            padding: .35em .65em;
            border-radius: .375rem;
            margin-right: .5rem;
            margin-bottom: .5rem;
            font-size: .875em;
        }
        .site-badge .remove-site {
            margin-left: .5em;
            cursor: pointer;
            font-size: 1.1em;
            line-height: 1;
        }
        .site-list {
            margin-top: .5rem;
            min-height: 38px; /* Assicurati che ci sia spazio anche senza badge */
            border: 1px solid #555;
            border-radius: .375rem;
            padding: .5rem;
            background-color: #333;
        }
    </style>
</head>
<body>

    <div class="container mt-5">
        <div class="card p-4">
            <div class="card-header text-center mb-4">
                <h1 class="mb-0">Query Builder</h1>
            </div>
            <form id="queryForm">
                <div class="mb-3">
                    <label for="keywords" class="form-label">Parole chiave (separate da virgola):</label>
                    <input type="text" class="form-control" id="keywords" placeholder="es: intelligenza artificiale, machine learning">
                </div>
                
                <div class="mb-3">
                    <label for="exactPhrase" class="form-label">Frase esatta:</label>
                    <input type="text" class="form-control" id="exactPhrase" placeholder="es: 'nuove scoperte scientifiche'">
                </div>
                
                <div class="mb-3">
                    <label for="excludeWords" class="form-label">Parole da escludere (separate da virgola):</label>
                    <input type="text" class="form-control" id="excludeWords" placeholder="es: -prezzo, -costo">
                </div>
                
                <div class="mb-3">
                    <label for="filetype" class="form-label">Formato file (filetype:):</label>
                    <select class="form-select" id="filetype">
                        <option value="">Nessuno</option>
                        <option value="pdf">PDF</option>
                        <option value="doc">DOC</option>
                        <option value="docx">DOCX</option>
                        <option value="ppt">PPT</option>
                        <option value="pptx">PPTX</option>
                        <option value="xls">XLS</option>
                        <option value="xlsx">XLSX</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="siteIncludeInput" class="form-label">Siti da includere (site:):</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="siteIncludeInput" placeholder="es: wikipedia.org">
                        <button class="btn btn-primary" type="button" id="addSiteIncludeBtn"><i class="bi bi-plus-lg"></i></button>
                    </div>
                    <div id="siteIncludeList" class="site-list d-flex flex-wrap align-items-center">
                        </div>
                </div>

                <div class="mb-3">
                    <label for="siteExcludeInput" class="form-label">Siti da escludere (-site:):</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="siteExcludeInput" placeholder="es: pinterest.com">
                        <button class="btn btn-primary" type="button" id="addSiteExcludeBtn"><i class="bi bi-plus-lg"></i></button>
                    </div>
                    <div id="siteExcludeList" class="site-list d-flex flex-wrap align-items-center">
                        </div>
                </div>

                <div class="mb-3">
                    <label for="timeRange" class="form-label">Intervallo di tempo (ultime 24h, settimana, mese, anno):</label>
                    <input type="range" class="form-range" id="timeRange" min="0" max="4" value="0">
                    <span id="timeRangeValue" class="d-block mt-2 text-center">Nessuno</span>
                </div>
                
                <div class="mb-4 form-check">
                    <input class="form-check-input" type="checkbox" id="imageSearch">
                    <label class="form-check-label" for="imageSearch">Cerca immagini</label>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">Cerca su Google</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const form = document.getElementById('queryForm');
        const keywords = document.getElementById('keywords');
        const exactPhrase = document.getElementById('exactPhrase');
        const excludeWords = document.getElementById('excludeWords');
        const filetype = document.getElementById('filetype');
        
        // Nuovi elementi per i siti multipli
        const siteIncludeInput = document.getElementById('siteIncludeInput');
        const addSiteIncludeBtn = document.getElementById('addSiteIncludeBtn');
        const siteIncludeListDiv = document.getElementById('siteIncludeList');
        let includedSites = []; // Array per i siti da includere

        const siteExcludeInput = document.getElementById('siteExcludeInput');
        const addSiteExcludeBtn = document.getElementById('addSiteExcludeBtn');
        const siteExcludeListDiv = document.getElementById('siteExcludeList');
        let excludedSites = []; // Array per i siti da escludere

        const timeRange = document.getElementById('timeRange');
        const imageSearch = document.getElementById('imageSearch');
        const timeRangeValue = document.getElementById('timeRangeValue');
        
        const timeRanges = ['Nessuno', 'Ultimi 24 ore', 'Ultima settimana', 'Ultimo mese', 'Ultimo anno'];

        timeRange.addEventListener('input', () => {
            timeRangeValue.textContent = timeRanges[timeRange.value];
        });

        // Funzione per creare un badge di sito
        function createSiteBadge(site, listArray, listDiv, prefix = '') {
            const siteText = site.trim();
            if (siteText === '') return; // Non aggiungere siti vuoti

            const badge = document.createElement('span');
            badge.classList.add('site-badge');
            badge.textContent = siteText;
            
            const removeBtn = document.createElement('i');
            removeBtn.classList.add('bi', 'bi-x-lg', 'remove-site');
            removeBtn.addEventListener('click', () => {
                const index = listArray.indexOf(siteText);
                if (index > -1) {
                    listArray.splice(index, 1);
                    listDiv.removeChild(badge);
                    saveStateToLocalStorage();
                }
            });
            
            badge.appendChild(removeBtn);
            listDiv.appendChild(badge);
            
            // Aggiungi il sito all'array se non è già presente
            if (!listArray.includes(siteText)) {
                listArray.push(siteText);
            }
        }

        // Funzione per popolare la lista di badge
        function populateSiteList(listArray, listDiv, prefix = '') {
            listDiv.innerHTML = ''; // Pulisci la lista esistente
            listArray.forEach(site => {
                createSiteBadge(site, listArray, listDiv, prefix);
            });
        }

        // Add site include
        addSiteIncludeBtn.addEventListener('click', () => {
            const site = siteIncludeInput.value.trim();
            if (site && !includedSites.includes(site)) {
                createSiteBadge(site, includedSites, siteIncludeListDiv);
                siteIncludeInput.value = '';
                saveStateToLocalStorage();
            }
        });
        siteIncludeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Evita il submit del form
                addSiteIncludeBtn.click();
            }
        });

        // Add site exclude
        addSiteExcludeBtn.addEventListener('click', () => {
            const site = siteExcludeInput.value.trim();
            if (site && !excludedSites.includes(site)) {
                createSiteBadge(site, excludedSites, siteExcludeListDiv);
                siteExcludeInput.value = '';
                saveStateToLocalStorage();
            }
        });
        siteExcludeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Evita il submit del form
                addSiteExcludeBtn.click();
            }
        });

        // Funzione per salvare lo stato in local storage
        function saveStateToLocalStorage() {
            const currentState = {
                keywords: keywords.value,
                exactPhrase: exactPhrase.value,
                excludeWords: excludeWords.value,
                filetype: filetype.value,
                includedSites: includedSites, // Salva gli array di siti
                excludedSites: excludedSites,
                timeRange: timeRange.value,
                imageSearch: imageSearch.checked
            };
            localStorage.setItem('queryBuilderState', JSON.stringify(currentState));
        }

        // Load saved values from local storage
        document.addEventListener('DOMContentLoaded', () => {
            const savedState = localStorage.getItem('queryBuilderState');
            if (savedState) {
                const state = JSON.parse(savedState);
                keywords.value = state.keywords || '';
                exactPhrase.value = state.exactPhrase || '';
                excludeWords.value = state.excludeWords || '';
                filetype.value = state.filetype || '';
                
                // Carica e popola gli array dei siti
                includedSites = state.includedSites || [];
                excludedSites = state.excludedSites || [];
                populateSiteList(includedSites, siteIncludeListDiv);
                populateSiteList(excludedSites, siteExcludeListDiv);

                timeRange.value = state.timeRange || '0';
                imageSearch.checked = state.imageSearch || false;
                timeRangeValue.textContent = timeRanges[timeRange.value];
            }
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            saveStateToLocalStorage(); // Salva lo stato prima di creare la query
            
            let queryParts = [];

            // Add keywords
            if (keywords.value.trim() !== '') {
                queryParts.push(keywords.value.split(',').map(kw => kw.trim()).join(' '));
            }

            // Add exact phrase
            if (exactPhrase.value.trim() !== '') {
                queryParts.push(`"${exactPhrase.value.trim()}"`);
            }

            // Add excluded words
            if (excludeWords.value.trim() !== '') {
                queryParts.push(excludeWords.value.split(',').map(ew => `-${ew.trim()}`).join(' '));
            }

            // Add filetype
            if (filetype.value !== '') {
                queryParts.push(`filetype:${filetype.value}`);
            }

            // Add included sites
            if (includedSites.length > 0) {
                queryParts.push(includedSites.map(site => `site:${site}`).join(' '));
            }

            // Add excluded sites
            if (excludedSites.length > 0) {
                queryParts.push(excludedSites.map(site => `-site:${site}`).join(' '));
            }
            
            // Build the final query string
            const finalQuery = queryParts.join(' ').trim(); // Aggiunto .trim() per evitare spazi extra
            
            // Get the time range parameter
            let timeParam = '';
            switch(timeRange.value) {
                case '1': timeParam = '&as_qdr=d'; break;
                case '2': timeParam = '&as_qdr=w'; break;
                case '3': timeParam = '&as_qdr=m'; break;
                case '4': timeParam = '&as_qdr=y'; break;
            }

            // Determine base URL
            let baseUrl = 'https://www.google.com/search?q=';
            if (imageSearch.checked) {
                baseUrl = 'https://www.google.com/search?tbm=isch&q=';
            }
            
            const url = `${baseUrl}${encodeURIComponent(finalQuery)}${timeParam}`;

            // Controlla se la query finale è vuota prima di aprire
            if (finalQuery) {
                window.open(url, '_blank');
            } else {
                alert("La query è vuota! Inserisci almeno una parola chiave o un sito.");
            }
        });
    </script>
</body>
</html>